<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>MiTablero AAC</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
  <meta name="theme-color" content="#111827" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap"
    rel="stylesheet">
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="dot-container">
        <div class="dot"></div>
        <div class="dot-ring"></div>
      </div>
      <div>
        <div class="title">MiTablero AAC</div>
        <div class="subtitle" id="statusText">Cargando tablero...</div>
      </div>
    </div>

    <div class="actions">
      <button class="btn glass" id="btnSettings" aria-label="Ajustes">‚öôÔ∏è</button>
      <button class="btn glass" id="btnEdit" aria-label="Editar tablero">‚úèÔ∏è</button>
    </div>
  </header>

  <main class="layout">
    <section class="composer glass" aria-label="Frase">
      <div class="composer-row">
        <div class="chips" id="chips"></div>
      </div>

      <div class="composer-actions">
        <div class="speech-controls">
          <button class="btn glass" id="btnPause" title="Pausar Voz">‚è∏</button>
          <button class="btn glass danger" id="btnStop" title="Detener Voz">‚èπ</button>
        </div>
        <button class="btn primary-action speak-btn" id="btnSpeak">
          <span class="icon">üîä</span>
          <span class="text">Hablar Frase</span>
        </button>
        <div class="utility-actions">
          <button class="btn glass secondary" id="btnBackspace" title="Borrar √∫ltimo">‚å´</button>
          <button class="btn glass danger" id="btnClear" title="Limpiar todo">üóëÔ∏è</button>
        </div>
      </div>
    </section>

    <section class="toolbar" aria-label="Filtros y B√∫squeda">
      <div class="pill-container" id="categoryBar"></div>
      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input class="search-input glass" id="searchBox" placeholder="Buscar palabras o categor√≠as..."
          autocomplete="off" />
      </div>
    </section>

    <section class="routine-bar glass hidden" id="routineBar" aria-label="Rutina Visual">
      <div class="routine-label">Rutina:</div>
      <div id="routineItems" class="routine-items"></div>
      <button class="btn glass danger" id="btnResetRoutine">‚úï</button>
    </section>

    <section class="grid" id="grid" aria-label="Tablero"></section>

    <!-- Virtual Companion -->
    <div id="companion" class="companion-container">
      <div class="companion-avatar">üå±</div>
      <div class="companion-bubble hidden" id="companionBubble">¬°Hola! Estoy aqu√≠ para acompa√±arte.</div>
    </div>
  </main>

  <footer class="legal-footer glass" aria-label="Informaci√≥n legal y contacto">
    <h2>Descargo de responsabilidad</h2>
    <p>
      Esta herramienta es un apoyo de comunicaci√≥n aumentativa y alternativa (CAA). No reemplaza la evaluaci√≥n,
      el diagn√≥stico ni el tratamiento de profesionales de salud.
    </p>
    <p>
      Autor: <strong>Cesar Celada</strong>. Si necesitas aclaraciones, mejoras o sugerencias,
      escribe a <a href="mailto:drceladapsiquiatria@gmail.com">drceladapsiquiatria@gmail.com</a>.
    </p>
    <p>
      Proyecto sin fines de lucro. Si deseas colaborar, puedes donar en
      <a href="https://buymeacoffee.com/herramente" target="_blank" rel="noopener noreferrer">buymeacoffee.com/herramente</a>.
    </p>
  </footer>

  <!-- MODAL: Editor -->
  <dialog class="modal glass-modal" id="editModal">
    <form method="dialog" class="modal-card">
      <div class="modal-head">
        <div>
          <div class="modal-title">Configurar Tablero</div>
          <div class="modal-sub">Gestiona tus elementos de comunicaci√≥n</div>
        </div>
        <button class="btn-close" value="cancel" aria-label="Cerrar">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="editor-grid">
          <div class="editor-form">
            <div class="row">
              <label class="field">
                <span>Palabra / Frase</span>
                <input id="itemText" maxlength="40" placeholder="Ej. Agua" required />
              </label>

              <label class="field">
                <span>Categor√≠a</span>
                <input id="itemCategory" maxlength="24" placeholder="Ej. Necesidades" />
              </label>
            </div>

            <div class="row">
              <div class="field">
                <span>Imagen (Local o ARASAAC)</span>
                <div class="image-options">
                  <div class="file-input-wrapper">
                    <input id="itemImage" type="file" accept="image/*" />
                    <label for="itemImage" class="btn glass">Subir Archivo</label>
                  </div>
                  <div class="arasaac-search-trigger">
                    <input id="arasaacQuery" class="glass-input" placeholder="Buscar en ARASAAC..." />
                    <button type="button" class="btn glass" id="btnSearchArasaac">üîç</button>
                  </div>
                </div>
              </div>

              <label class="field">
                <span>Color de Borde</span>
                <input id="itemColor" type="color" value="#22c55e" />
              </label>
            </div>

            <div id="arasaacResults" class="arasaac-results glass-card hidden">
              <!-- Results will be injected here -->
            </div>

            <div class="preview-container">
              <span>Vista previa</span>
              <div class="preview glass-card" id="preview">Esperando datos...</div>
            </div>

            <button class="btn primary full-width" id="btnAddItem">‚ûï A√±adir al Cat√°logo</button>
          </div>

          <div class="data-mgmt">
            <div class="divider text">Respaldo y Datos</div>
            <div class="row compact">
              <button class="btn primary-action flex-grow" id="btnLoadLibrary">üìö Cargar Biblioteca Ilustrada</button>
            </div>
            <div class="row compact" style="margin-top: 10px;">
              <button class="btn glass secondary flex-grow" id="btnExport">üíæ Exportar JSON</button>
              <button class="btn glass secondary flex-grow" id="btnImport">üì• Importar JSON</button>
              <input id="importFile" type="file" accept="application/json" hidden />
            </div>
          </div>
        </div>

        <div class="divider text">Tus Elementos</div>
        <div class="list" id="itemList"></div>
      </div>

      <div class="modal-foot">
        <button class="btn glass" value="cancel">Cerrar</button>
      </div>
    </form>
  </dialog>

  <!-- MODAL: Settings -->
  <dialog class="modal glass-modal" id="settingsModal">
    <form method="dialog" class="modal-card">
      <div class="modal-head">
        <div>
          <div class="modal-title">Ajustes del Sistema</div>
          <div class="modal-sub">Personalizaci√≥n y accesibilidad</div>
        </div>
        <button class="btn-close" value="cancel" aria-label="Cerrar">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="settings-section">
          <h3>Voz y Lectura</h3>
          <div class="row">
            <label class="field">
              <span>Voz</span>
              <select id="voiceSelect" class="glass-input"></select>
            </label>

            <label class="field">
              <span>Velocidad de voz</span>
              <input id="rate" type="range" min="0.6" max="1.4" step="0.1" />
            </label>

            <label class="field">
              <span>Modo de Lectura</span>
              <select id="speechMode" class="glass-input">
                <option value="fluent">Fluida (Oraci√≥n)</option>
                <option value="word">Palabra por palabra</option>
              </select>
            </label>
          </div>
        </div>

        <div class="settings-section">
          <h3>Interfaz y Tablero</h3>
          <div class="row">
            <label class="field">
              <span>Tama√±o de botones</span>
              <input id="tileSize" type="range" min="80" max="160" step="5" />
            </label>

            <label class="field">
              <span>Modo de Interacci√≥n</span>
              <select id="tapMode" class="glass-input">
                <option value="add">1 toque = a√±adir a frase</option>
                <option value="speak">1 toque = hablar √≠tem</option>
              </select>
            </label>

            <label class="field">
              <span>Perfil de Tablero</span>
              <select id="boardProfile" class="glass-input">
                <option value="default">General</option>
                <option value="home">Casa</option>
                <option value="school">Escuela / Terapia</option>
                <option value="sos">Emergencias</option>
              </select>
            </label>
          </div>
        </div>

        <div class="settings-section">
          <h3>Accesibilidad</h3>
          <label class="field-row">
            <div class="toggle-wrapper">
              <input id="scanningEnabled" type="checkbox" />
              <span class="toggle-slider"></span>
            </div>
            <div class="text-content">
              <span class="main">Modo de Barrido (Scanning)</span>
              <span class="sub">Cicla autom√°ticamente entre botones (usa Espacio/Enter para seleccionar)</span>
            </div>
          </label>

          <label class="field-row">
            <div class="toggle-wrapper">
              <input id="showGrammarTags" type="checkbox" />
              <span class="toggle-slider"></span>
            </div>
            <div class="text-content">
              <span class="main">Etiquetas Gramaticales</span>
              <span class="sub">Muestra (V, S, A, N, O) sobre cada bot√≥n (Motor Planning)</span>
            </div>
          </label>

          <label class="field-row">
            <div class="toggle-wrapper">
              <input id="showRoutine" type="checkbox" />
              <span class="toggle-slider"></span>
            </div>
            <div class="text-content">
              <span class="main">Mostrar Panel de Rutina</span>
              <span class="sub">Habilita una barra superior para organizar horarios visuales</span>
            </div>
          </label>
        </div>

        <div class="settings-section">
          <h3>Seguridad</h3>
          <label class="field-row">
            <div class="toggle-wrapper">
              <input id="lockEdit" type="checkbox" />
              <span class="toggle-slider"></span>
            </div>
            <div class="text-content">
              <span class="main">Bloquear edici√≥n</span>
              <span class="sub">Evita cambios accidentales en el tablero</span>
            </div>
          </label>

          <label class="field-row">
            <div class="toggle-wrapper">
              <input id="tutorMode" type="checkbox" />
              <span class="toggle-slider"></span>
            </div>
            <div class="text-content">
              <span class="main">Modo Tutor (Filtrado)</span>
              <span class="sub">Oculta o muestra elementos espec√≠ficos para cada sesi√≥n</span>
            </div>
          </label>
        </div>

        <div class="settings-section">
          <h3>Cl√≠nico</h3>
          <button type="button" class="btn glass warning full-width" id="btnOpenHistory">üìä Ver Bit√°cora de Uso</button>
        </div>

        <div class="settings-section">
          <h3>Informaci√≥n legal</h3>
          <p class="legal-note">
            Esta app es un recurso CAA y no reemplaza diagn√≥stico ni tratamiento profesional.
            Autor: Cesar Celada ¬∑ Contacto: drceladapsiquiatria@gmail.com ¬∑ Proyecto sin fines de lucro.
            Donaciones: buymeacoffee.com/herramente.
          </p>
        </div>
      </div>

      <div class="modal-foot">
        <button class="btn primary" value="cancel">Guardar Cambios</button>
      </div>
    </form>
  </dialog>

  <!-- MODAL: History (Specialist Panel) -->
  <dialog class="modal glass-modal" id="historyModal">
    <form method="dialog" class="modal-card">
      <div class="modal-head">
        <div>
          <div class="modal-title">Bit√°cora Cl√≠nica</div>
          <div class="modal-sub">Registro local y privado de actividad</div>
        </div>
        <button class="btn-close" value="cancel">‚úï</button>
      </div>
      <div class="modal-body">
        <div id="historyList" class="history-list">
          <p class="empty-state">No hay registros de actividad a√∫n.</p>
        </div>
      </div>
      <div class="modal-foot">
        <button class="btn glass danger" id="btnClearHistory">Borrar Historial</button>
        <button class="btn primary" value="cancel">Cerrar</button>
      </div>
    </form>
  </dialog>

  <!-- MODAL: PIN (Tutor Mode Security) -->
  <dialog class="modal glass-modal" id="pinModal">
    <form method="dialog" class="modal-card mini">
      <div class="modal-head">
        <div class="modal-title">PIN de Seguridad</div>
        <button class="btn-close" value="cancel">‚úï</button>
      </div>
      <div class="modal-body">
        <p>Ingresa el PIN para entrar al Modo Tutor:</p>
        <input type="password" id="pinInput" maxlength="4" class="glass-input center" placeholder="****" />
      </div>
      <div class="modal-foot">
        <button class="btn primary full-width" id="btnVerifyPin">Entrar</button>
      </div>
    </form>
  </dialog>

  <script type="module" src="app.js"></script>
</body>

</html>
